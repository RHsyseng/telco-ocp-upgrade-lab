<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CNF Upgrade Preparation :: LAB - Telco OCP Upgrade Lab</title>
    <link rel="canonical" href="https://labs.sysdeseng.com/4.10/CNF-Upgrade-Prep.html">
    <meta name="generator" content="Antora 3.1.6">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com/en/solutions/telecommunications" target="_blank"><img src="../_/img/Logo-Red_Hat-A-Reverse-RGB.png" height="40px" alt="Red Hat Telco Solutions"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://labs.sysdeseng.com">LAB - Telco OCP Upgrade Lab</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="4.10" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Welcome</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#contributors">Contributors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#lab-aim">Who is this lab aimed at?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#lab-software-versions">Lab Software Versions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="API-Compatibility.html">OCP API Compatibility Policy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="API-Compatibility.html#cnf-api-compatibility">CNF API Compatibility</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="API-Compatibility.html#k8s-skew">Kubernetes Version Skew</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="API-Compatibility.html#ocp-upgrade-path">OpenShift Upgrade Path</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">LAB - Telco OCP Upgrade Lab</a></li>
    <li><a href="CNF-Upgrade-Prep.html">CNF Upgrade Preparation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/rfisher/github/telco-ocp-upgrade-lab/documentation/modules/ROOT/pages/CNF-Upgrade-Prep.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">CNF Upgrade Preparation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The life of a POD is an important topic to understand. This section will describe several topics that are important to
keeping your CNF PODs healthy and allow the cluster to properly schedule them during an upgrade.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cnf_requirements_document"><a class="anchor" href="#_cnf_requirements_document"></a>CNF Requirements Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you go any further, please read through the <a href="https://connect.redhat.com/sites/default/files/2022-05/Cloud%20Native%20Network%20Function%20Requirements%201-3.pdf">CNF requirements document</a>.
In this section a few of the most important points will be discussed but the CNF Requirements Document has additional
detail and other important topics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pod_disruption_budget"><a class="anchor" href="#_pod_disruption_budget"></a>POD Disruption Budget</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each set of PODs in a deployment can be given a specific minimum number of PODs that should be running in order to keep
from disrupting the functionality of the CNF, thus called the POD disruption budget (PDB). However, this budget can be
improperly configured. <br>
For example, if you have 4 PODs in a deployment and your PDB is set to 4, this means that you are telling the scheduler
that you NEED 4 PODs running at all times. Therefore, in this scenario ZERO PODs can come down.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="../assets/images/PDB-full.jpg" alt="PDB full">
</div>
<div class="title">Figure 1. Deployment with no PDB</div>
</div>
<div class="paragraph">
<p>To fix this, the PDB can be set to 2, letting 2 of the 4 pods to be scheduled as down and this would then let the worker
nodes where those PODs are located be rebooted.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="../assets/images/PDB-down-2.jpg" alt="PDB down 2">
</div>
<div class="title">Figure 2. Deployment with PDB</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pod_anti_affinity"><a class="anchor" href="#_pod_anti_affinity"></a>POD Anti-affinity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>True high availability requires a duplication of a process to be running on separate hardware, thus making sure that an
application will continue to run if one piece of hardware goes down. OpenShift can easily make that happen since
processes are automatically duplicated in separate PODs within a deployment. However, those PODs need to have
anti-affinity set on them so that they are NOT running on the same hardware. It so happens that anti-affinity also
helps during upgrades because it makes sure that PODs are on different worker nodes, therefore allowing enough PODs to
come down even after considering their PDB.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_liveness_readiness_probes"><a class="anchor" href="#_liveness_readiness_probes"></a>Liveness / Readiness Probes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift and Kubernetes have some built in features that not everyone takes advantage of called
<a href="https://docs.openshift.com/container-platform/4.12/applications/application-health.html">liveness and readiness probes</a>.
These are very important when POD deployments are dependent upon keeping state for their application. This document
wonâ€™t go into detail regarding these probes but please review the <a href="https://docs.openshift.com/container-platform/4.12/applications/application-health.html">OpenShift documentation</a>
on how to implement their use.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
